{% extends 'economia/base.html' %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>ðŸŽ¯ Metas de Ahorro</h2>
    <a href="{% url 'meta_nueva' %}" class="btn btn-success">âž• Nueva Meta</a>
  </div>

  {% if metas %}
    <table class="table table-hover shadow-sm">
      <thead class="table-light">
        <tr>
          <th>Nombre</th>
          <th>Monto Objetivo</th>
          <th>Monto Actual</th>
          <th>Progreso</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for meta in metas %}
          <tr>
            <td>{{ meta.nombre_meta }}</td>
            <td>Bs. {{ meta.monto_objetivo }}</td>
            <td>Bs. {{ meta.monto_actual }}</td>
            <td>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar {% if meta.progreso >= 100 %}bg-success{% else %}bg-info{% endif %}"
                     role="progressbar"
                     style="width: {{ meta.progreso }}%"
                     aria-valuenow="{{ meta.progreso }}"
                     aria-valuemin="0"
                     aria-valuemax="100">
                  {{ meta.progreso|floatformat:1 }}%
                </div>
              </div>
            </td>
            <td>
              {% if meta.estado == 'cumplida' %}
                <span class="badge bg-success">Cumplida</span>
              {% elif meta.estado == 'vencida' %}
                <span class="badge bg-danger">Vencida</span>
              {% else %}
                <span class="badge bg-warning text-dark">En progreso</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'meta_editar' meta.pk %}" class="btn btn-sm btn-primary">Editar</a>
              <button class="btn btn-sm btn-danger btnEliminarMeta"
                data-url="{% url 'meta_eliminar' meta.pk %}">
                Eliminar
              </button>

            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    
        <hr>
        <div class="text-center">
          <a href="{% url 'dashboard' %}" class="btn btn-secondary px-4">â†© Volver</a>
        </div>
        
  {% else %}
    <p class="text-muted text-center mt-4">No hay metas registradas aÃºn.</p>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    document.querySelectorAll(".btnEliminarMeta").forEach(btn => {
        btn.addEventListener("click", function (e) {
            e.preventDefault();

            const url = this.dataset.url;

            Swal.fire({
                title: "Â¿Eliminar meta?",
                text: "Esta acciÃ³n no se puede deshacer.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "SÃ­, eliminar",
                cancelButtonText: "Cancelar"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url;
                }
            });
        });
    });

});
</script>


{% endblock %}
